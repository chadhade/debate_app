<script type="text/javascript"> 
  	jug.subscribe("debate_" + <%= debate.id %>, function(data){  
		if (data.func == "argument") {
			<% if Rails.env.development? or Rails.env.test? %>
				$(".debate[data-id="+ <%= debate.id %> +"]").append(data.obj.argument);
			<% else %>
				$.each(data.obj.argument, function(idx, val) {   
					$(".debate[data-id="+ <%= debate.id %> +"]").append(val);
				});
			<% end %>
 
			if ("<%= current_debater.email %>" == data.obj.current_turn) {
			    <% if Rails.env.development? or Rails.env.test? %>      	
					$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(data.obj.post_box);
				<% else %>
					$.each(data.obj.post_box, function(idx, val) {    
						$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(val);
					});
				<% end %>	
			}
			else {
			    <% if Rails.env.development? or Rails.env.test? %> 
				    $(".post_to_debate[data-id="+ <%= debate.id %> +"]").html("");
				<% else %>
					$.each(data.obj.post_box, function(idx, val) { 
						$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html("");
					});
				<% end %>	
			}
		
			if (data.obj.footnotes != false) {
				<% if Rails.env.development? or Rails.env.test? %> 
					document.getElementById("footnotes").innerHTML=data.obj.footnotes;
				<% else %>
					$.each(data.obj.footnotes, function(idx, val) { 
						document.getElementById("footnotes").innerHTML=val;
					});
				<% end %>
			}
			if (data.obj.judge == true) {
				abort_timer[<%= debate.id %>] = 1;  // Stop the previous timer from running
				javascript_countdown.init(data.obj.timers.movingclock, data.obj.timers.staticclock, data.obj.timers.movingposition, data.obj.timers.debateid);
			}
		}
		
		if (data.func == "erase_postbox") {
			if ("<%= current_debater.email %>" == data.obj.current_turn) {
				<% if Rails.env.development? or Rails.env.test? %>      	
					$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(data.obj.post_box);
				<% else %>
					$.each(data.obj.post_box, function(idx, val) {    
						$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(val);
					});
				<% end %>			
			}
			else {
				$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html("");
			}
	
		}
		
		if (data.func == "judge_results") {
			<% if Rails.env.development? or Rails.env.test? %>      	
				$('#statuspanel').append(data.obj.judging_results);			
			<% else %>
				$('#statuspanel').append(data.obj.judging_results[0]);
			<% end %>
		}
		
		if (data.func == "judge_arrived") {
			//abort_timer[<%= debate.id %>] = 1;  // Stop the previous timer from running
			javascript_countdown.init(data.obj.timers.movingclock, data.obj.timers.staticclock, data.obj.timers.movingposition, data.obj.timers.debateid);
			var img = document.createElement("IMG");
				img.src = "/assets/gavel.png";
			var element = document.getElementById("judge-<%= debate.id %>");
				element.innerHTML = "";
				element.appendChild(img);
				voteable[<%= debate.id %>] = true;
			if ("<%= current_debater.email %>" == data.obj.current_turn) {
			    <% if Rails.env.development? or Rails.env.test? %>      	
					$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(data.obj.post_box);
				<% else %>
					$.each(data.obj.post_box, function(idx, val) {    
						$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(val);
					});
				<% end %>
			}
		}

		if (data.func == "joiner")	{
			$(".timertitle-2").html(data.obj.joiner);
			moving_clock[data.obj.timers.debateid] = data.obj.timers.staticclock;
			document.getElementById("timer2-<%= debate.id %>").innerHTML=format_output(data.obj.timers.staticclock);
			voteable[<%= debate.id %>] = false;
		}

		if (data.func == "end_single") {
			if ("<%= current_debater.email %>" == data.obj.current_turn) {
			 
				<% if Rails.env.development? or Rails.env.test? %>      	
					$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(data.obj.post_box);
				<% else %>
					$.each(data.obj.post_box, function(idx, val) {    
						$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html(val);
					});
				<% end %>			
			}
			else {
				$(".post_to_debate[data-id="+ <%= debate.id %> +"]").html("");
			}
			position = Math.abs(moving_position[<%= debate.id %>] - 3);
			javascript_countdown.init(static_clock[<%= debate.id %>], 0, position, <%= debate.id %>);
		}
	});
	
	<% if current_debater != debate.judger %>
		jug.subscribe("debate_" + <%= debate.id %> + "_votes", function(votes){
		
			if (votes.obj.type == "true") {
				incrementVotesFor(votes.obj.id);
			}
			else {
				incrementVotesAgainst(votes.obj.id);
			}
		});
	<% end %>
	
	<% if current_debater == debate.judger %>
		jug.subscribe("debate_" + <%= debate.id %> + "_judge", function(data){
			if (data.judging_form =="clear_form") {
				$('.judging_form').remove();
			}
			if (data.func == "judging_form") {
				<% if Rails.env.development? or Rails.env.test? %>      	
					$('#statuspanel').append(data.obj.judging_form);
				<% else %>
					$('#statuspanel').append(data.obj.judging_form[0]);
				<% end %>
			}
			if (data.func == "judge_votes") {
				if (data.obj.votes.type == "true") {
					incrementVotesFor(data.obj.votes.id);
				}
				else {
					incrementVotesAgainst(data.obj.votes.id);
				}
			}
		});
	<% end %>
	
	function format_output(timetoformat) {
		var hours, minutes, seconds;
		seconds = timetoformat % 60;
		minutes = Math.floor(timetoformat / 60) % 60;
		hours = Math.floor(timetoformat / 3600);
 
		seconds = add_leading_zero( seconds );
		minutes = add_leading_zero( minutes );
		hours = add_leading_zero( hours );
 
		return hours + ':' + minutes + ':' + seconds;
	}
	
	function add_leading_zero(n) {
		if(n.toString().length < 2) {
			return '0' + n;
		} else {
			return n;
		}
	}
</script>