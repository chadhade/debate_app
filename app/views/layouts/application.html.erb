<!DOCTYPE html>
<html>
<head>
  	<title>DeBunky</title>
	<%= stylesheet_link_tag "application" %>
  	<%= javascript_include_tag "application" %>
	<%= javascript_include_tag "jquery.qtip" %>
  	<%= csrf_meta_tags %>
		
</head>
<body>
	<%= render :partial => "/layouts/navigation" %>
	
	<%= render :partial => "/layouts/instruction_boxes" %>
	
	<div class= "sitewidth">
		<% flash.each do |key, value| %>
			<div class="flash <%= key %>"><%= value %></div>
		<% end %>
		
		<%= yield %>
	</div>
	<%= render :partial => "/layouts/waiting_box" %>
	<%= render :partial => "/shared/init_juggernaut" %>
	<script>
		// Subscribe debater to the Waiting Channel if he/she is currently waiting
		$(document).ready(function(){
			//<%# if debater_signed_in? %>
				<% unless current_or_guest_debater.waiting_for == nil %>

					<% debate = Debate.find_by_id(current_or_guest_debater.waiting_for) %>	
					<% unless debate.end_time %>
					
							jug.subscribe("waiting_channel", function(data){  
								if ((data.func == "debate_update") && (data.obj.debate == <%= current_or_guest_debater.waiting_for %>)) {
									$('.waiting_content').html(data.obj.status_value);
									if(data.obj.status_code == 3) {
										$(".waiting_box").children("h3").html("Debate Started!");
										$(".waiting_box").children("h3").css("background-color", "red");
									}
								}	
							});

					<% end %>

				<% end %>
			//<%# end %>
		});
	</script>
	<%= javascript_include_tag "jquery_tips" %>
</body>
</html>
